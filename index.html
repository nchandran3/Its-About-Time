<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/main.css" />
    <script src="js/jquery.js"></script>

    <title>It's About Time</title>
</head>
<body>
    <div id="wrap">
        <div id="map">
            <div id="title">It's About Time</div>
   
            <div class="marker marker-raval" id="raval">
                <div class="icon"></div>
                <div class="name"></div>

            </div>
            <div class="marker marker-placareial" id="placareial">
                <div class="icon"></div>
                <div class="name"></div>

            </div>
            <div class="marker marker-fortpienc" id="fortpienc">
                <div class="icon"></div>
                <div class="name"></div>
                
            </div>
            <div class="marker marker-arc" id="arc">
                <div class="icon"></div>
                <div class="name"></div>
                
            </div>
            <div class="marker marker-macba" id="macba">
                <div class="icon"></div>
                <div class="name"></div>
                
            </div>
        </div>
        <div id="display">
            <div id="exitdisplay">X</div>
            <div id="galleries"></div>

            <div id="slide">
                <div id="slidetitle">This is a title</div>
            </div>
            <div id="slidecaption"></div>
            <div id="navwrap">
                <div class="nav" id="goleft">
                    <span class="glyphicon glyphicon-chevron-left"></span>
                </div>
                <div class="nav" id="goright">
                    <span class="glyphicon glyphicon-chevron-right"></span>
                </div>
            </div>
        </div>
    </div>
<script>
var imagesJSON = '{\
   "raval" :\
   {\
        "name": "Rambla de Raval",\
        "location": [388,228],\
        "images" : [\
            {\
                "url": "images/raval1.jpg",\
                "time": 14\
            }          \
        ]\
    },\
    "fortpienc" : \
    {\
        "name": "Fort Pienc",\
        "location": [159,1092],\
        "images" : []\
    },\
    "placareial" :\
    {\
        "name": "Pla&ccedil;a Reial",\
        "location": [487,418],\
        "images" : []\
    },\
    "arc" :\
    {\
        "name": "Arc de Triomf",\
        "location": [287,900],\
        "images" : []\
    },\
    "macba" :\
    {\
        "name": "MACBA",\
        "location": [201,305],\
        "times" : {\
            "day" :\
            {\
                "name": "Day",\
                "thumb": "images/macbadaythumb.jpg",\
                "images" : [\
                    {\
                        "url": "images/macbaday1.jpg",\
                        "caption": "During the day at the MACBA"\
                    },\
                    {\
                        "url": "images/macbaday2.jpg",\
                        "caption": "During the day at the MACBA"\
                    }\
                ]\
            },\
            "evening" :\
            {\
                "name": "Evening",\
                "thumb": "images/macbaeveningthumb.jpg",\
                "images" : [\
                    {\
                        "url": "images/macba2.jpg",\
                        "caption": "This is a caption"\
                    }\
                ]\
            },\
            "night" :\
            {\
                "name": "Night",\
                "thumb": "images/macbanightthumb.jpg",\
                "images": [\
                    {\
                        "url": "images/macba3.jpg",\
                        "caption": "This is a caption"\
                    }\
                ]\
            }\
        }\
    }\
}';
var images = $.parseJSON(imagesJSON);
var onDisplay = 0;

// This can be done before the document is ready, because they are then reset
// and animated into place
placeMarkers(images);

$(document).ready(function() {
    $(".marker").click(function() {
        showDisplay(this.id);
    });

    $("#exitdisplay").click(function() {
        $("#display").fadeOut(250);
    });

});

/*
 * Position markers to correct coordinates
 */
function placeMarkers(images) {
    $.each(images, function(key, value) {
        $marker = $("#" + key);
        $marker.css({top: value.location[0], left: value.location[1]});
        $marker.children(".name").html(value.name)
    });
}

/*
 * Displays image by index with caption, and updates nav arrows
 */
function loadImage(image) {
    $("#slide").fadeOut(50, function() {
        $("#slide").css({"background-image": "url('" + image["url"] + "')"});
        $(this).fadeIn(200);
    });

    $("#slidecaption").html(image["caption"]);
}

/*
 * Loads gallery images and handles picture navigation
 */
function loadGallery(location, time) {
    var gallery = images[location]["times"][time];

    $("#slidetitle").html(gallery["name"]);

    onDisplay = 0;
    loadImage(gallery["images"][onDisplay]);

    // This off/on stuff deals with removing previous listeners created at each loadGallery call, and creating new ones
    $("#goleft").off("click").on("click", function() {
        // Force a positive index
        onDisplay = (onDisplay - 1 + gallery["images"].length) % gallery["images"].length;

        loadImage(gallery["images"][onDisplay]);
    });

    $("#goright").off("click").on("click", function() {
        onDisplay = (onDisplay + 1) % gallery["images"].length;

        loadImage(gallery["images"][onDisplay]);
    });
}

/*
 * Makes visible the slideshow window. Populates by default with the first gallery
 */
function showDisplay(location) {
    $("#display").fadeIn(250);
    $("#galleries").empty();

    // Dictionary of gallery times
    timesList = images[location]["times"];

    $.each(timesList, function(key, value) {
        var activeCss = "";
        if (key == "day") {
            loadGallery(location, key);
            activeCss = "galleryActive";
        }
        $("#galleries").append("<div class='gallery " + activeCss + "' " + 
            "data-id='" + key + "'>" +
            "<div class='gallerythumb' style='background-image: url(\"" +
            value.thumb + "\")'></div>" + "<div class='galleryname'>" +
            value.name + "</div></div>");
    });


    $(".gallery").click(function() {
        $(".gallery").removeClass("galleryActive");
        $(this).addClass("galleryActive");
        loadGallery(location, $(this).data("id"));
    }).hover(function () {
        $(this).children(".galleryname").addClass("selected");
    } ,function() {
        $(this).children(".galleryname").removeClass("selected");
    });


}
</script>
<script src="js/Animations.js"></script>

</body>
</html>